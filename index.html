<!doctype html>
<html lang="en">
  <head>
    <title>Rust-Wasm Typing Game</title>
  </head>
  <body>
    <h1>Rust-Wasm Typing Game</h1>
    Score: <span id="score">0</span><br />
    Multiplier: <span id="multiplier">1.00x</span><br />
    Type the character:
    <div id="character-to-type"></div>
    <br />
    <input type="text" id="typing-text" disabled /><br />
    <button id="start-button">Start Game</button><br />
    <!--use JavaScript to use methods compiled from Rust-Wasm-->
    <script type="module">
      import init, { Game } from "./pkg/rust_wasm_typing_game.js";
      const scoreText = document.getElementById("score"); //score text
      const multiplierText = document.getElementById("multiplier"); //score multiplier text
      const characterText = document.getElementById("character-to-type"); //character to type text
      const startButton = document.getElementById("start-button"); //start button
      const typingText = document.getElementById("typing-text"); //entered text input
      async function run() {
        //function to run the program
        await init({}); //initialization function
        let game = new Game(); //create new game
        startButton.addEventListener("click", () => {
          game = new Game(); //create new game
          typingText.disabled = false; //enable typing text input
          startButton.disabled = true; //disable start button
          scoreText.textContent = game.get_score().toLocaleString("en-US"); //update score text
          multiplierText.textContent =
            game
              .get_multiplier()
              .toLocaleString("en-US", {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
              }) + "x"; //update score multiplier text
          characterText.textContent = game.get_character_to_type(); //update character to type text
        });
        characterText.textContent = game.get_character_to_type(); //update character to type text
        typingText.addEventListener("input", (event) => {
          //do action when key is pressed in typing text field
          const key = event.target.value; //get entered text
          const correctKey = game.check_typing(typingText.value); //check if entered text is correct (entered key is equal to character to type)
          if (correctKey || typingText.value === game.get_character_to_type()) {
            //if this is correct
            typingText.value = ""; //clear typing text value
          }
          game.handle_typing(key); //handle typing input
          scoreText.textContent = game.get_score().toLocaleString("en-US"); //update score text
          multiplierText.textContent =
            game
              .get_multiplier()
              .toLocaleString("en-US", {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
              }) + "x"; //update score multiplier text
          characterText.textContent = game.get_character_to_type(); //update character to type text
        });
      }
      run(); //run the program
    </script>
  </body>
</html>
